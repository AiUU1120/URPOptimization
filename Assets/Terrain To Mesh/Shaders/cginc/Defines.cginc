#ifndef TERRAIN_TO_MESH_DEFINES_CGINC
#define TERRAIN_TO_MESH_DEFINES_CGINC



#if defined(_T2M_LAYER_COUNT_3) 

    #define LAYERS_COUNT 3
    
    #define RENDER_SPLATMAP_0   

    #define RENDER_LAYER_2

#elif defined(_T2M_LAYER_COUNT_4)

    #define LAYERS_COUNT 4

    #define RENDER_SPLATMAP_0
    
    #define RENDER_LAYER_2
    #define RENDER_LAYER_3

#elif defined(_T2M_LAYER_COUNT_5)

    #define LAYERS_COUNT 5

    #define RENDER_SPLATMAP_0
    #define RENDER_SPLATMAP_1
    
    #define RENDER_LAYER_2
    #define RENDER_LAYER_3
    #define RENDER_LAYER_4

#elif defined(_T2M_LAYER_COUNT_6)

    #define LAYERS_COUNT 6

    #define RENDER_SPLATMAP_0
    #define RENDER_SPLATMAP_1
    
    #define RENDER_LAYER_2
    #define RENDER_LAYER_3
    #define RENDER_LAYER_4
    #define RENDER_LAYER_5

#elif defined(_T2M_LAYER_COUNT_7)

    #define LAYERS_COUNT 7

    #define RENDER_SPLATMAP_0
    #define RENDER_SPLATMAP_1
    
    #define RENDER_LAYER_2
    #define RENDER_LAYER_3
    #define RENDER_LAYER_4
    #define RENDER_LAYER_5
    #define RENDER_LAYER_6

#elif defined(_T2M_LAYER_COUNT_8)

    #define LAYERS_COUNT 8
    
    #define RENDER_SPLATMAP_0
    #define RENDER_SPLATMAP_1
    
    #define RENDER_LAYER_2
    #define RENDER_LAYER_3
    #define RENDER_LAYER_4
    #define RENDER_LAYER_5
    #define RENDER_LAYER_6
    #define RENDER_LAYER_7

#elif defined(_T2M_LAYER_COUNT_9)

    #define LAYERS_COUNT 9
    
    #define RENDER_SPLATMAP_0
    #define RENDER_SPLATMAP_1
    #define RENDER_SPLATMAP_2
    
    #define RENDER_LAYER_2
    #define RENDER_LAYER_3
    #define RENDER_LAYER_4
    #define RENDER_LAYER_5
    #define RENDER_LAYER_6
    #define RENDER_LAYER_7
    #define RENDER_LAYER_8

#elif defined(_T2M_LAYER_COUNT_10)

    #define LAYERS_COUNT 10

    #define RENDER_SPLATMAP_0
    #define RENDER_SPLATMAP_1
    #define RENDER_SPLATMAP_2

    #define RENDER_LAYER_2
    #define RENDER_LAYER_3
    #define RENDER_LAYER_4
    #define RENDER_LAYER_5
    #define RENDER_LAYER_6
    #define RENDER_LAYER_7
    #define RENDER_LAYER_8
    #define RENDER_LAYER_9

#elif defined(_T2M_LAYER_COUNT_11)

    #define LAYERS_COUNT 11

    #define RENDER_SPLATMAP_0
    #define RENDER_SPLATMAP_1
    #define RENDER_SPLATMAP_2
    
    #define RENDER_LAYER_2
    #define RENDER_LAYER_3
    #define RENDER_LAYER_4
    #define RENDER_LAYER_5
    #define RENDER_LAYER_6
    #define RENDER_LAYER_7
    #define RENDER_LAYER_8
    #define RENDER_LAYER_9
    #define RENDER_LAYER_10

#elif defined(_T2M_LAYER_COUNT_12)

    #define LAYERS_COUNT 12    

    #define RENDER_SPLATMAP_0
    #define RENDER_SPLATMAP_1
    #define RENDER_SPLATMAP_2
    
    #define RENDER_LAYER_2
    #define RENDER_LAYER_3
    #define RENDER_LAYER_4
    #define RENDER_LAYER_5
    #define RENDER_LAYER_6
    #define RENDER_LAYER_7
    #define RENDER_LAYER_8
    #define RENDER_LAYER_9
    #define RENDER_LAYER_10
    #define RENDER_LAYER_11

#elif defined(_T2M_LAYER_COUNT_13)

    #define LAYERS_COUNT 13

    #define RENDER_SPLATMAP_0
    #define RENDER_SPLATMAP_1
    #define RENDER_SPLATMAP_2
    #define RENDER_SPLATMAP_3
    
    #define RENDER_LAYER_2
    #define RENDER_LAYER_3
    #define RENDER_LAYER_4
    #define RENDER_LAYER_5
    #define RENDER_LAYER_6
    #define RENDER_LAYER_7
    #define RENDER_LAYER_8
    #define RENDER_LAYER_9
    #define RENDER_LAYER_10
    #define RENDER_LAYER_11
    #define RENDER_LAYER_12

#elif defined(_T2M_LAYER_COUNT_14)

    #define LAYERS_COUNT 14

    #define RENDER_SPLATMAP_0
    #define RENDER_SPLATMAP_1
    #define RENDER_SPLATMAP_2
    #define RENDER_SPLATMAP_3
    
    #define RENDER_LAYER_2
    #define RENDER_LAYER_3
    #define RENDER_LAYER_4
    #define RENDER_LAYER_5
    #define RENDER_LAYER_6
    #define RENDER_LAYER_7
    #define RENDER_LAYER_8
    #define RENDER_LAYER_9
    #define RENDER_LAYER_10
    #define RENDER_LAYER_11
    #define RENDER_LAYER_12
    #define RENDER_LAYER_13

#elif defined(_T2M_LAYER_COUNT_15)

    #define LAYERS_COUNT 15

    #define RENDER_SPLATMAP_0
    #define RENDER_SPLATMAP_1
    #define RENDER_SPLATMAP_2
    #define RENDER_SPLATMAP_3
    
    #define RENDER_LAYER_2
    #define RENDER_LAYER_3
    #define RENDER_LAYER_4
    #define RENDER_LAYER_5
    #define RENDER_LAYER_6
    #define RENDER_LAYER_7
    #define RENDER_LAYER_8
    #define RENDER_LAYER_9
    #define RENDER_LAYER_10
    #define RENDER_LAYER_11
    #define RENDER_LAYER_12
    #define RENDER_LAYER_13
    #define RENDER_LAYER_14

#elif defined(_T2M_LAYER_COUNT_16)

    #define LAYERS_COUNT 16

    #define RENDER_SPLATMAP_0
    #define RENDER_SPLATMAP_1
    #define RENDER_SPLATMAP_2
    #define RENDER_SPLATMAP_3

    #define RENDER_LAYER_2
    #define RENDER_LAYER_3
    #define RENDER_LAYER_4
    #define RENDER_LAYER_5
    #define RENDER_LAYER_6 
    #define RENDER_LAYER_7 
    #define RENDER_LAYER_8
    #define RENDER_LAYER_9
    #define RENDER_LAYER_10
    #define RENDER_LAYER_11
    #define RENDER_LAYER_12
    #define RENDER_LAYER_13
    #define RENDER_LAYER_14
    #define RENDER_LAYER_15

#else

    #define LAYERS_COUNT 2

    #define RENDER_SPLATMAP_0
    
#endif 


#define T2M_ZERO_FLOAT4                                     float4(0, 0, 0, 0)
#define T2M_HALF_FLOAT4                                     float4(0.5, 0.5, 0.5, 0.5)
#define T2M_ONE_FLOAT4                                      float4(1, 1, 1, 1)
#define T2M_ZERO_FLOAT2                                     float2(0, 0)


#if defined(TERRAIN_TO_MESH_BUILTIN_SAMPLER)
    #define T2M_DECLARE_SAMPLER_STATE(s)
#else
    #define T2M_DECLARE_SAMPLER_STATE(s)                    SAMPLER(s);
#endif


#define CALCULATE_LAYER_UV(target, index, uv)               target = uv * _T2M_Layer_##index##_uvScaleOffset.xy + _T2M_Layer_##index##_uvScaleOffset.zw;

#define T2M_REMAP_MASK(index, m)                            m = RemapMasks(m, _T2M_Layer_##index##_MaskMapRemapMin, _T2M_Layer_##index##_MaskMapRemapMax); 
#define T2M_SUM_MASK(index, m, w)                           metallicSmoothnessOcclusion += m * w; 
#define T2M_SUM_METALLIC_OCCLUSION_SMOOTHNESS(index, d, w)  metallicSmoothnessOcclusion += float4(lerp(GammaToLinearSpaceExact(GammaToLinearSpaceExact(_T2M_Layer_##index##_MetallicOcclusionSmoothness.r)), _T2M_Layer_##index##_MetallicOcclusionSmoothness.r, IsGammaSpace()), _T2M_Layer_##index##_MetallicOcclusionSmoothness.g, 0, lerp(_T2M_Layer_##index##_MetallicOcclusionSmoothness.a, d.a, _T2M_Layer_##index##_SmoothnessFromDiffuseAlpha)) * w;
#define T2M_SUM_EMPTY_NORMAL(index, w)                      normalValue += w * float3(0, 0, 1);


#if defined(_T2M_TEXTURE_SAMPLE_TYPE_ARRAY)
    
    #define T2M_DECALRE_NORMAL(l)               
    #define T2M_DECALRE_MASK(l)                 

    #define T2M_UNPACK_SPLAT_MAP(target, uv, index)         target = SAMPLE_TEXTURE2D_ARRAY(_T2M_SplatMaps2DArray, sampler_T2M_SplatMaps2DArray, uv, index);
    #define T2M_UNPACK_DIFFUSE_MAP(index, d, uv)	        d = (_T2M_Layer_##index##_MapsUsage.x > 0.5 ? SAMPLE_TEXTURE2D_ARRAY(_T2M_DiffuseMaps2DArray, sampler_T2M_DiffuseMaps2DArray, uv, paintMapUsageIndex) : float4(1, 1, 1, 1));  paintMapUsageIndex += _T2M_Layer_##index##_MapsUsage.x > 0.5 ? 1 : 0;  d.rgb *= _T2M_Layer_##index##_ColorTint.rgb;
	#define T2M_UNPACK_NORMAL_MAP(index, uv, w)             normalValue += TerrainToMeshNormalStrength(UnpackNormal(SAMPLE_TEXTURE2D_ARRAY(_T2M_NormalMaps2DArray, sampler_T2M_NormalMaps2DArray, uv, normalMapUsageIndex)), _T2M_Layer_##index##_NormalScale) * w;	normalMapUsageIndex += 1;
    #define T2M_UNPACK_MASK_MAP(index, m, uv)               m = SAMPLE_TEXTURE2D_ARRAY(_T2M_MaskMaps2DArray, sampler_T2M_MaskMaps2DArray, uv, maskMapUsageIndex);  maskMapUsageIndex += 1;   

#else

    #define T2M_DECALRE_NORMAL(l)                           TEXTURE2D(_T2M_Layer_##l##_NormalMap); 
    #define T2M_DECALRE_MASK(l)                             TEXTURE2D(_T2M_Layer_##l##_Mask);

    #if defined(TERRAIN_TO_MESH_BUILTIN_SAMPLER)
        #define T2M_UNPACK_SPLAT_MAP(target, uv, index)     target = _T2M_SplatMap_##index.Sample(BUILTIN_SAMPLER_CLAMP, uv);
        #define T2M_UNPACK_DIFFUSE_MAP(index, d, uv)        d = _T2M_Layer_##index##_Diffuse.Sample(BUILTIN_SAMPLER_REPEAT, uv); d.rgb *= _T2M_Layer_##index##_ColorTint.rgb;
	    #define T2M_UNPACK_NORMAL_MAP(index, uv, w)         normalValue += TerrainToMeshNormalStrength(UnpackNormal(_T2M_Layer_##index##_NormalMap.Sample(BUILTIN_SAMPLER_REPEAT, uv)), _T2M_Layer_##index##_NormalScale) * w;
        #define T2M_UNPACK_MASK_MAP(index, m, uv)           m = _T2M_Layer_##index##_Mask.Sample(BUILTIN_SAMPLER_REPEAT, uv);
   
    #else
        #define T2M_UNPACK_SPLAT_MAP(target, uv, index)     target = SAMPLE_TEXTURE2D(_T2M_SplatMap_##index, sampler_T2M_SplatMap_0, uv);
        #define T2M_UNPACK_DIFFUSE_MAP(index, d, uv)        d = SAMPLE_TEXTURE2D(_T2M_Layer_##index##_Diffuse, sampler_T2M_Layer_0_Diffuse, uv); d.rgb *= _T2M_Layer_##index##_ColorTint.rgb;
	    #define T2M_UNPACK_NORMAL_MAP(index, uv, w)         normalValue += TerrainToMeshNormalStrength(UnpackNormal(SAMPLE_TEXTURE2D(_T2M_Layer_##index##_NormalMap, sampler_T2M_Layer_0_Diffuse, uv)), _T2M_Layer_##index##_NormalScale) * w;        
        #define T2M_UNPACK_MASK_MAP(index, m, uv)           m = SAMPLE_TEXTURE2D(_T2M_Layer_##index##_Mask, sampler_T2M_Layer_0_Diffuse, uv); 

    #endif

#endif




#if defined(TERRAIN_TO_MESH_BUILTIN_SAMPLER)
    #define T2M_UNPACK_HOLESMAP(uv)                        _T2M_HolesMap.Sample(BUILTIN_SAMPLER_CLAMP, uv);
#else
    #define T2M_UNPACK_HOLESMAP(uv)                        SAMPLE_TEXTURE2D(_T2M_HolesMap, sampler_T2M_HolesMap, uv);
#endif


#endif